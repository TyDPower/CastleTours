@inject IUserService UserService
@inject ITourService TourService
@inject IAuthService AuthService

<MudToggleIconButton    @bind-Toggled="@IsFavorite"
                        @onclick="HandleClick"
                        Icon="@Icons.Filled.FavoriteBorder"
                        Color="@Color.Error"
                        Title="Off"
                        ToggledIcon="@Icons.Filled.Favorite"
                        ToggledColor="@Color.Success"
                        ToggledTitle="On"/>



@code {

    [Parameter] public bool IsFavorite { get; set; }
    [Parameter] public int TourId { get; set; }

    protected bool IsAuthorized = false;

    protected override async Task OnInitializedAsync()
    {
        IsAuthorized = await AuthService.GetUserAuthState();
    }

    private async Task HandleClick()
    {
        if (IsAuthorized)
        {
            if (IsFavorite)
            {
                await UserService.RemoveFavorite(TourId);
                IsFavorite = false;
            }
            else
            {
                Favorite newFavorite = new Favorite
                {
                    DateFavorited = DateTime.Now,
                    TourId = TourId,
                    UserId = UserService.User.Id
                };

                await UserService.AddFavorite(newFavorite);
                IsFavorite = true;
            }
        }
        else
        {
            
        }
    }
}
